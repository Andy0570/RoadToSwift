> 原文：[Scaling Your Xcode Projects With Tuist](https://getstream.io/blog/xcode-tuist/)



Tuist 是一个可以轻松生成和扩展 Xcode 项目的工具。这篇文章将向您展示我们的 iOS 团队如何使用 Tuist 以及它如何使您的团队受益。

iOS 开发团队面临的最大挑战之一是在他们的公司或产品起飞时扩展代码库。增长和扩展问题是一件好事，但它们也带来了一些典型的成长烦恼，例如：

* 在将开发工作分散到多个团队时，明确定义职责。
* 随着您的代码库不断增长，减少每个开发人员的编辑 - 构建 - 运行周期。

[Tuist](https://tuist.io/) 由 Tuist 组织经营。多年来，它们已被证明是 iOS 开发者社区中的一个稳定因素。他们实际上维护了其他开发人员用来实现他们的工具的一些较小的工件，例如 Sourcery、ProjLint、XcodeGen 和 xspm。

出于多种原因，Stream 决定赞助 Tuist 组织。我们希望你也这样做。他们维护了一些重要的工具，并正在为您提供一种能够扩展基于 Xcode 的代码库的绝佳方式。

本文的其余部分将重点介绍 Tuist 作为帮助您扩展项目的工具。它要求您转变对 Xcode 项目文件的思维方式。但一旦你这样做，你将获得巨大的收益。 Xcode 项目文件中不再有冲突，轻松一致地添加和管理框架配置。移动和组织代码变得轻而易举，您的编译时间将大大减少。

## 什么是 Tuist？

Tuist 通过用 Swift 语言本身描述 Xcode 项目来帮助您维护它们。它允许您轻松地跨项目重用项目配置，因此您可以专注于代码库的特定区域。您可以在 Tuist 中定义自己的公司特定约定项目，以实现跨多个项目的一致结构。

Tuist 支持由单个 target 或数百个 target 组成的项目（在 Xcode 中，每个 framework 至少包含一个 target）。一旦您熟悉了 Tuist，就没有理由不将您的代码库拆分为多个 framework，以促进正确的组件化和功能隔离。

它甚至解决了管理 Xcode 项目所涉及的一些复杂性。你在 Swift 代码中定义你的项目，在你开始工作之前，你会生成你的 Xcode 项目。在基于 Xcode 的代码库上与多个贡献者一起工作时，最后一个功能可能会处理您面临的 90% 以上的合并冲突。



## 在您的项目中采用 Tuist

您可以在现有和新项目中开始使用 Tuist。最简单的方法显然是在一个新项目中开始使用 Tuist。但是，我们也看到了 Tuist 在现有项目中的成功采用。

如果您正在开发一个新项目，请查看（Tuist 的入门指南）[https://docs.tuist.io/tutorial/get-started]。如果您想在现有项目中采用 Tuist，请查看（采用 Tuist 指南）[https://docs.tuist.io/guides/adopting-tuist]。



## 将 Tuist 集成到您的 CI 构建环境中

在任何 CI 构建环境中集成 Tuist 应该不会造成任何问题。在克隆或拉取源代码的步骤之后，您需要确保 Xcode 项目是由 Tuist 生成的。运行 tuist generate 就可以做到这一点。生成 Xcode 项目后，CI 构建环境会负责其余的工作。

在代码库上工作时可以应用相同的过程。显然，Tuist 可执行文件需要在您的 CI 环境中可用。您可以将其作为命令行工具安装在 CI 平台上，但您也可以将 Tuist 作为工具捆绑到项目存储库中。

要捆绑 Tuist，您需要在开发机器上做几件事：

1. 通过运行 tuist local 检查当前使用的 Tuist 版本。
2. 获取您当前在本地使用的版本号，并通过运行 tuist local x.y.q 将您的代码库固定到该版本，其中 x.y.z 是您要使用的当前本地版本的 Tuist。
3. 运行 tuist bundle 以捆绑 Tuist 二进制文件。
4. 提交并推送您的本地更改。

如果您的 CI 环境中默认没有安装 Tuist，则您不必安装 Tuist。只需将 Tuist 的调用从 tuist generate 更改为 .tuist-bin/tuist generate。因为现在这是捆绑的 Tuist 版本驻留在您的存储库中的路径。

## Tuist 能为您做什么

### 管理您的框架

在处理 Xcode 项目时，您通常必须通过 CocoaPods、Carthage、Swift Packages 和 XCFrameworks 处理第三方依赖项。最重要的是，将您自己的代码库拆分为多个框架也是会发生的事情。特别是在更大的代码库上。在 Xcode 中工作时，您最终必须处理各种形式的框架。

Tuist 使以一致的方式管理框架变得更加容易，无论是第三方还是您自己的框架。 Tuist 是一个约定驱动的工具；除了工具本身定义的约定外，您还可以在其之上应用您的项目特定约定。 Tuist 允许您以一致的方式构建代码和目标配置。通过利用约定，您可以将现有代码快速移动到新框架中，并在几分钟内定义全新的框架。



### 处理第三方依赖

在开发 iOS 应用程序时，第三方依赖项很重要。它可能是一个供应商框架或一些开源代码，使您不必自己编写很多东西。无论您需要集成什么框架，您都将通过 CocoaPods、Carthage、Swift 包管理器、XCFrameworks 或者甚至是带有一些头文件的静态库来处理第三方依赖项。

Tuist 抽象出许多用于管理 iOS 依赖项的细节。最终结果是您自己创建的依赖项和目标（应用程序目标和框架）的简明集成视图。

将 Tuist 用于第三方依赖项的好处是您变得与依赖项管理器无关。使用任何相关依赖管理器定义的任何依赖都将起作用。



### 缓存预建依赖

在处理 Xcode 项目时，编译时间是一个重要因素，尤其是在处理更大的代码库时。 Swift 的部分强大之处在于它的灵活性，但能够做到这一点会带来语言实现的复杂性，在编译 Swift 代码时会注意到这种复杂性。尤其是在处理协议一致性时，编译复杂性会飙升。处理编译时间的最好方法是根本不编译。 Tuist 可以通过预编译部分代码并检测哪些预构建的依赖项由于源代码更改而需要重新编译来帮助解决这个问题。



### 创建基于组件的代码库

因为 Tuist 允许您轻松地使用框架，无论是在创建框架还是在整个项目中保持它们的一致性方面，您都可以通过将代码放在单独的框架中来将代码划分为组件。 Swift 中的框架允许您在自己的代码库中定义清晰的 API 边界。公共、内部和私有范围有了意义。



### 减少编译时间

除了预先构建代码库的部分之外，将代码本身分离成组件也会减少编译时间。最有可能的是，您将采用一种方法，通过正确界定它们的范围，在您创建的框架中隐藏实现细节。



## 结论

采用 Tuist 需要付出努力，它确实改变了每个开发人员的工作流程。但是，能够轻松地将您的代码库划分为几个（如果不是很多）框架，则解锁了开始将您的 Xcode 项目视为真正的组件集合的能力。在需要时很容易将项目组件分支成一个成熟的 Swift SPM 包，从而增加重用性。

最重要的是，Tuist 可以缩短编译时间，因为更多的实现细节保存在代码库的较小部分中。编译器在编译时必须一次查看更少的 Swift 文件。如果这还不够，Tuist 提供了缓存您在代码库中定义的框架的编译版本的能力。

总而言之，如果编译时间成为您项目中的问题，Tuist 可以提供处理这些问题的方法。甚至在此之前，能够以基于组件的方式定义您的项目本身就是一个巨大的好处。尤其是在同一个项目中与多人甚至多个团队一起工作时。



